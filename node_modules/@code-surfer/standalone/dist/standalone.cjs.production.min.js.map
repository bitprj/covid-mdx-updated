{"version":3,"file":"standalone.cjs.production.min.js","sources":["../src/errors.tsx","../src/dimensions.ts","../src/easing.ts","../src/animation.ts","../src/lines.tsx","../src/tuple.ts","../src/frame.tsx","../src/code-surfer.tsx","../src/use-window-resize.ts","../src/index.tsx"],"sourcesContent":["import React from \"react\";\n\ntype UnknownErrorProps = {\n  error: { toString: () => string };\n};\n\nexport function UnknownError({ error }: UnknownErrorProps) {\n  // TODO link to create issue\n  return <ErrorBox header=\"Oops, there's a problem\" body={error.toString()} />;\n}\n\nexport function grammarNotFound({ lang }: { lang: string }) {\n  return {\n    element: (\n      <ErrorBox\n        header=\"Oops, there's a problem\"\n        body={\n          <React.Fragment>\n            Syntax highlighter for <Mark>\"{lang}\"</Mark> not found.\n            <p>\n              You can try importing it from prismjs with: <br />\n              <Mark>import \"prismjs/components/prism-{lang}\"</Mark>\n            </p>\n            (See{\" \"}\n            <a\n              href=\"https://prismjs.com/#supported-languages\"\n              style={{ color: \"grey\" }}\n            >\n              all the supported languages\n            </a>\n            )\n          </React.Fragment>\n        }\n      />\n    )\n  };\n}\n\nexport function invalidFocusNumber(n: string) {\n  return {\n    withFocusString: (focusString: string) => ({\n      withStepIndex: (stepIndex: number) => ({\n        element: (\n          <ErrorBox\n            header={<StepErrorHeader stepIndex={stepIndex} />}\n            body={\n              <React.Fragment>\n                <Mark>\"{n}\"</Mark> isn't a valid number{\" \"}\n                {n != focusString && <Mark> (in \"{focusString}\")</Mark>}\n              </React.Fragment>\n            }\n          />\n        )\n      })\n    })\n  };\n}\n\nexport function invalidLineOrColumnNumber() {\n  return {\n    withFocusString: (focusString: string) => ({\n      withStepIndex: (stepIndex: number) => ({\n        element: (\n          <ErrorBox\n            header={<StepErrorHeader stepIndex={stepIndex} />}\n            body={\n              <React.Fragment>\n                Are you using \"0\" as a line or column number{\" \"}\n                <Mark>in \"{focusString}\"</Mark>?\n                <br />\n                (Line and column numbers should start at 1, not 0) <br />\n              </React.Fragment>\n            }\n          />\n        )\n      })\n    })\n  };\n}\n\ntype ErrorBoxProps = {\n  header: React.ReactNode;\n  body: React.ReactNode;\n};\n\nfunction ErrorBox({ header, body }: ErrorBoxProps) {\n  return (\n    <div\n      style={{\n        background: \"#290000\",\n        color: \"#b96f70\",\n        border: \"2px solid #b96f70\",\n        padding: \"10px 30px\",\n        maxWidth: \"90vw\",\n        margin: \"0 auto\",\n        fontFamily: \"monospace\",\n        fontSize: \"1rem\"\n      }}\n    >\n      <h3>{header}</h3>\n      <p>{body}</p>\n    </div>\n  );\n}\n\nfunction StepErrorHeader({ stepIndex }: { stepIndex: number }) {\n  return (\n    <React.Fragment>\n      Oops, there's a problem with the{\" \"}\n      <Mark>\n        {stepIndex + 1}\n        <sup>{ordinal(stepIndex + 1)}</sup> step\n      </Mark>\n    </React.Fragment>\n  );\n}\n\nfunction Mark({ children }: { children: React.ReactNode }) {\n  return (\n    <mark style={{ background: \"none\", color: \"pink\", fontWeight: \"bolder\" }}>\n      {children}\n    </mark>\n  );\n}\n\nfunction ordinal(i: number) {\n  var j = i % 10,\n    k = i % 100;\n  if (j == 1 && k != 11) {\n    return \"st\";\n  }\n  if (j == 2 && k != 12) {\n    return \"nd\";\n  }\n  if (j == 3 && k != 13) {\n    return \"rd\";\n  }\n  return \"th\";\n}\n","import React from \"react\";\nimport { Step, Dimensions } from \"code-surfer-types\";\nimport useWindowResize from \"./use-window-resize\";\n\ntype DimensionsResult = { steps?: Step[]; dimensions?: Dimensions };\n\nfunction useDimensions<T extends HTMLElement | null>(\n  ref: React.MutableRefObject<T>,\n  steps: Step[]\n): DimensionsResult {\n  const [result, setResult] = React.useState<DimensionsResult | null>(null);\n\n  // TODO reset only if container size changed\n  useWindowResize(() => setResult(null), [setResult]);\n\n  React.useLayoutEffect(() => {\n    if (!ref.current) return;\n    if (result) return;\n\n    const containers = ref.current.querySelectorAll(\n      \".cs-container\"\n    ) as NodeListOf<HTMLElement>;\n\n    const stepsDimensions = Array.from(containers).map((container, i) =>\n      getStepDimensions(container, steps[i])\n    );\n\n    const containerHeight = Math.max(\n      ...stepsDimensions.map(d => d.containerHeight)\n    );\n\n    const containerWidth = Math.max(\n      ...stepsDimensions.map(d => d.containerWidth)\n    );\n\n    const contentWidth = Math.max(...stepsDimensions.map(d => d.contentWidth));\n\n    const lineHeight = Math.max(...stepsDimensions.map(d => d.lineHeight));\n\n    setResult({\n      dimensions: {\n        lineHeight,\n        contentWidth,\n        containerHeight,\n        containerWidth,\n        // TODO set or remove\n        contentHeight: undefined\n      },\n      steps: steps.map((step, i) => ({\n        ...step,\n        dimensions: {\n          paddingTop: stepsDimensions[i].paddingTop,\n          paddingBottom: stepsDimensions[i].paddingBottom\n        }\n      }))\n    });\n  }, [result]);\n\n  return result || {};\n}\n\nfunction getStepDimensions(container: HTMLElement, step: Step) {\n  const longestLineKey = step.lines[step.longestLineIndex];\n  const longestLineSpan = container.querySelector(`.cs-line-${longestLineKey}`);\n  const containerParent = container.parentElement as HTMLElement;\n  const title = container.querySelector(\".cs-title\") as HTMLElement;\n  const subtitle = container.querySelector(\".cs-subtitle\") as HTMLElement;\n\n  const lineCount = step.lines.length;\n  const heightOverflow =\n    containerParent.scrollHeight - containerParent.clientHeight;\n  const avaliableHeight = container.scrollHeight - heightOverflow;\n\n  const lineHeight = longestLineSpan ? longestLineSpan.clientHeight : 0;\n  const paddingTop = title ? outerHeight(title) : lineHeight;\n  const paddingBottom = subtitle ? outerHeight(subtitle) : lineHeight;\n\n  const codeHeight = lineCount * lineHeight * 2;\n  // const maxContentHeight = codeHeight + paddingTop + paddingBottom;\n  // const containerHeight = Math.min(maxContentHeight, avaliableHeight);\n  const containerHeight = avaliableHeight;\n  const containerWidth = container.clientWidth;\n  const contentHeight = codeHeight + containerHeight;\n\n  const contentWidth = longestLineSpan ? longestLineSpan.clientWidth : 0;\n\n  return {\n    lineHeight,\n    contentHeight,\n    contentWidth,\n    paddingTop,\n    paddingBottom,\n    containerHeight,\n    containerWidth\n  };\n}\n\nfunction outerHeight(element: HTMLElement) {\n  var styles = window.getComputedStyle(element);\n  var margin =\n    parseFloat(styles[\"marginTop\"] || \"0\") +\n    parseFloat(styles[\"marginBottom\"] || \"0\");\n  return element.offsetHeight + margin;\n}\n\nexport default useDimensions;\n","export type Easing = (t: number) => number;\n\nexport default {\n  // no easing, no acceleration\n  linear: function(t: number) {\n    return t;\n  },\n  // accelerating from zero velocity\n  easeInQuad: function(t: number) {\n    return t * t;\n  },\n  // decelerating to zero velocity\n  easeOutQuad: function(t: number) {\n    return t * (2 - t);\n  },\n  // acceleration until halfway, then deceleration\n  easeInOutQuad: function(t: number) {\n    return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n  },\n  // accelerating from zero velocity\n  easeInCubic: function(t: number) {\n    return t * t * t;\n  },\n  // decelerating to zero velocity\n  easeOutCubic: function(t: number) {\n    return --t * t * t + 1;\n  },\n  // acceleration until halfway, then deceleration\n  easeInOutCubic: function(t: number) {\n    return t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n  },\n  // accelerating from zero velocity\n  easeInQuart: function(t: number) {\n    return t * t * t * t;\n  },\n  // decelerating to zero velocity\n  easeOutQuart: function(t: number) {\n    return 1 - --t * t * t * t;\n  },\n  // acceleration until halfway, then deceleration\n  easeInOutQuart: function(t: number) {\n    return t < 0.5 ? 8 * t * t * t * t : 1 - 8 * --t * t * t * t;\n  },\n  // accelerating from zero velocity\n  easeInQuint: function(t: number) {\n    return t * t * t * t * t;\n  },\n  // decelerating to zero velocity\n  easeOutQuint: function(t: number) {\n    return 1 + --t * t * t * t * t;\n  },\n  // acceleration until halfway, then deceleration\n  easeInOutQuint: function(t: number) {\n    return t < 0.5 ? 16 * t * t * t * t * t : 1 + 16 * --t * t * t * t * t;\n  }\n};\n","import { CSSProperties } from \"react\";\nimport easing, { Easing } from \"./easing\";\nimport { Tuple } from \"./tuple\";\nimport { Step, Dimensions } from \"code-surfer-types\";\n\nconst distx = 250;\nconst outHeight = 0;\n\nconst [EXIT, SCROLL, ENTER] = [0.25, 0.75, 1];\n\ntype Animation<T> = (t: number) => T;\nexport type StyleAnimation = (t: number) => CSSProperties;\n\nexport function emptyStyle() {\n  return {} as CSSProperties;\n}\n\nexport function exitLine(\n  fromOpacity: number,\n  toOpacity: number,\n  staggerIndex: number,\n  staggerLength: number,\n  lineHeight: number = 100\n): StyleAnimation {\n  return chain(\n    [\n      [\n        EXIT,\n        stagger(\n          slideToLeft(fromOpacity, toOpacity),\n          staggerIndex,\n          staggerLength\n        )\n      ],\n      [SCROLL, shrinkHeight(lineHeight)],\n      [ENTER, undefined]\n    ],\n    {\n      height: lineHeight\n    }\n  );\n}\n\nexport function enterLine(\n  fromOpacity: number,\n  toOpacity: number,\n  staggerIndex: number,\n  staggerLength: number,\n  lineHeight: number = 100\n) {\n  return chain(\n    [\n      [EXIT, undefined],\n      [SCROLL, growHeight(lineHeight)],\n      [\n        ENTER,\n        stagger(\n          slideFromRight(fromOpacity, toOpacity),\n          staggerIndex,\n          staggerLength\n        )\n      ]\n    ],\n    {\n      transform: `translateX(${distx}px)`,\n      height: 0,\n      opacity: 0\n    }\n  );\n}\n\nexport function focus(fromOpacity: number, toOpacity: number) {\n  return (t: number) => ({ opacity: tween(fromOpacity, toOpacity, t) });\n}\n\nexport function unfocus(fromOpacity: number, toOpacity: number) {\n  return (t: number) => ({ opacity: tween(fromOpacity, toOpacity, t) });\n}\n\nexport function fadeInFocus(\n  fromOpacity: number,\n  toOpacity: number,\n  staggerIndex: number,\n  staggerLength: number\n) {\n  return chain(\n    [\n      [EXIT, undefined],\n      [SCROLL, undefined],\n      [\n        ENTER,\n        stagger(\n          t => ({\n            opacity: tween(fromOpacity, toOpacity, t)\n          }),\n          staggerIndex,\n          staggerLength\n        )\n      ]\n    ],\n    { opacity: fromOpacity }\n  );\n}\n\nexport function fadeOutFocus(\n  fromOpacity: number,\n  toOpacity: number,\n  staggerIndex: number,\n  staggerLength: number\n) {\n  return chain(\n    [\n      [\n        EXIT,\n        stagger(\n          t => ({\n            opacity: tween(fromOpacity, toOpacity, t)\n          }),\n          staggerIndex,\n          staggerLength\n        )\n      ],\n      [SCROLL, undefined],\n      [ENTER, undefined]\n    ],\n    { opacity: fromOpacity }\n  );\n}\n\nexport function fadeOutIn(offOpacity = 0) {\n  return chain([[0.5, fadeOut(offOpacity)], [1, fadeIn(offOpacity)]]);\n}\n\nexport function halfFadeIn(offOpacity = 0) {\n  return chain([[0.5, undefined], [1, fadeIn(offOpacity)]], { opacity: 0 });\n}\n\nexport function halfFadeOut(offOpacity = 0) {\n  return chain([[0.5, fadeOut(offOpacity)], [1, undefined]]);\n}\n\nexport function scrollToFocus(\n  stepPair: Tuple<Step>,\n  dimensions?: Dimensions\n): Animation<number> {\n  if (!dimensions) {\n    return () => 0;\n  }\n\n  const [prevStep, nextStep] = stepPair.spread();\n\n  const prevCenter = prevStep\n    ? prevStep.focusCenter * dimensions.lineHeight\n    : 0;\n  const nextCenter = nextStep\n    ? nextStep.focusCenter * dimensions.lineHeight\n    : 0;\n\n  const animation = chain(\n    [\n      [EXIT, undefined],\n      [\n        SCROLL,\n        t => ({\n          scroll: tween(prevCenter, nextCenter, t, easing.easeInOutCubic)\n        })\n      ],\n      [ENTER, undefined]\n    ],\n    { scroll: prevCenter }\n  );\n\n  return t => animation(t).scroll;\n}\n\nexport function scaleToFocus(\n  stepPair: Tuple<Step>,\n  dimensions?: Dimensions\n): Animation<number> {\n  if (!dimensions) {\n    return () => 1;\n  }\n\n  const [prev, next] = stepPair.spread();\n\n  const prevZoom = getZoom(prev, dimensions);\n  const nextZoom = getZoom(next, dimensions);\n\n  return t =>\n    tween(\n      prevZoom || nextZoom!,\n      nextZoom || prevZoom!,\n      t,\n      easing.easeInOutQuad\n    );\n}\n\n//\n\nfunction slideToLeft(startOpacity: number, endOpacity: number): StyleAnimation {\n  return (t: number) => ({\n    opacity: tween(startOpacity, endOpacity, t),\n    transform: `translateX(${tween(0, -distx, t)}px)`\n  });\n}\n\nfunction slideFromRight(\n  startOpacity: number,\n  endOpacity: number\n): StyleAnimation {\n  return (t: number) => ({\n    opacity: tween(startOpacity, endOpacity, t),\n    transform: `translateX(${tween(distx, 0, t)}px)`\n  });\n}\n\nfunction shrinkHeight(lineHeight: number): StyleAnimation {\n  return (t: number) => ({\n    height: tween(lineHeight, outHeight, t, easing.easeInOutCubic)\n  });\n}\n\nfunction growHeight(lineHeight: number): StyleAnimation {\n  return (t: number) => ({\n    height: tween(outHeight, lineHeight, t, easing.easeInOutCubic)\n  });\n}\n\nexport function fadeOut(offOpacity: number = 0): StyleAnimation {\n  return (t: number) => ({ opacity: tween(1, offOpacity, t) });\n}\n\nexport function fadeIn(offOpacity: number = 0): StyleAnimation {\n  return (t: number) => ({ opacity: tween(offOpacity, 1, t) });\n}\n\nexport function tween(\n  from: number,\n  to: number,\n  t: number,\n  ease: Easing = easing.linear\n) {\n  return from + (to - from) * ease(t);\n}\n\nexport function chain<T extends object>(\n  steps: [number, undefined | ((t: number) => T)][],\n  start: T = {} as T\n): Animation<T> {\n  return (t: number) => {\n    let style = Object.assign({}, start);\n    let prevTop = 0;\n    for (let i = 0; i < steps.length; i++) {\n      const [top, fn] = steps[i];\n\n      const stept = t > top ? 1 : (t - prevTop) / (top - prevTop);\n\n      if (fn) {\n        Object.assign(style, fn(stept));\n      }\n\n      if (t < top) {\n        return style;\n      }\n\n      prevTop = top;\n    }\n    return style;\n  };\n}\n\nexport function stagger<T>(\n  animation: Animation<T>,\n  staggerIndex: number,\n  staggerLength: number,\n  interval = 0.3\n): Animation<T> {\n  if (staggerLength <= 1) return animation;\n  const steps = interval / (staggerLength - 1);\n  const start = steps * staggerIndex;\n  const end = 1 - interval + start;\n  return t => {\n    const st = Math.max(0, Math.min(1, (t - start) / (end - start)));\n    return animation(st);\n  };\n}\n\nfunction getZoom(step: Maybe<Step>, dimensions: Dimensions): number | null {\n  if (!step) return null;\n\n  if (!dimensions || !step.dimensions)\n    throw new Error(\"Can't get zoom without dimensions\");\n\n  const {\n    containerHeight,\n    containerWidth,\n    contentWidth,\n    lineHeight\n  } = dimensions;\n\n  const { paddingBottom, paddingTop } = step.dimensions;\n\n  const contentHeight = step.focusCount * lineHeight;\n  const availableHeight =\n    containerHeight - Math.max(paddingBottom, paddingTop) * 2;\n  const yZoom = availableHeight / contentHeight;\n\n  // if there are lines that are too long for the container\n  const xZoom = (0.9 * containerWidth) / contentWidth;\n\n  return Math.min(yZoom, 1, xZoom);\n}\n","import { Tuple } from \"./tuple\";\nimport React, { CSSProperties } from \"react\";\nimport {\n  enterLine,\n  exitLine,\n  StyleAnimation,\n  emptyStyle,\n  fadeInFocus,\n  fadeOutFocus\n} from \"./animation\";\n\ntype Step = {\n  lines: number[];\n  focus: Record<number, true | number[]>;\n};\n\ntype LineListProps = {\n  stepPair: Tuple<Step>;\n  t: number;\n  tokens: string[][];\n  types: string[][];\n  dimensions?: { lineHeight: number };\n  unfocusedStyle: { opacity: number };\n};\n\nexport function LineList({\n  stepPair,\n  t,\n  tokens,\n  types,\n  dimensions,\n  unfocusedStyle\n}: LineListProps) {\n  const lines = React.useMemo(() => {\n    const linesPair = stepPair.selectMany((step: Step) =>\n      step.lines.map((lineKey, lineIndex) => ({\n        key: lineKey,\n        focus: step.focus[lineIndex]\n      }))\n    );\n\n    const fadeInLines = linesPair\n      .map((linePair, lineKey: number) => {\n        const [prev] = linePair.spread();\n        const [prevFocus, nextFocus] = linePair.select(l => l.focus).spread();\n        const isFadeIn =\n          !prev ||\n          (!prevFocus && nextFocus) ||\n          (nextFocus && Array.isArray(prevFocus));\n        return isFadeIn ? lineKey : -1;\n      })\n      .filter(key => key !== -1);\n\n    const fadeOutLines = linesPair\n      .map((linePair, lineKey: number) => {\n        const [, next] = linePair.spread();\n        const [prevFocus, nextFocus] = linePair.select(l => l.focus).spread();\n        const isFadeOut =\n          !next ||\n          (!nextFocus && prevFocus) ||\n          (prevFocus && Array.isArray(nextFocus));\n        return isFadeOut ? lineKey : -1;\n      })\n      .filter(key => key !== -1);\n\n    return linesPair.map((lineTuple, lineKey) => {\n      //TODO get from theme\n      const offOpacity = unfocusedStyle.opacity;\n\n      const [prevLine, nextLine] = lineTuple.spread();\n      const [prevFocus, nextFocus] = lineTuple.select(l => l.focus).spread();\n      const isMoving = !prevLine || !nextLine;\n      const isChangingFocus = prevFocus !== nextFocus;\n      const isStatic = !isMoving && !isChangingFocus;\n\n      const areTokensAnimated =\n        !isStatic && (Array.isArray(prevFocus) || Array.isArray(nextFocus));\n      const areTokensStatic = !areTokensAnimated;\n\n      const tokenElements =\n        areTokensStatic &&\n        tokens[lineKey].map((token, tokeni) => (\n          <span className={\"token-\" + types[lineKey][tokeni]} key={tokeni}>\n            {token}\n          </span>\n        ));\n\n      const { lineHeight } = dimensions || {};\n\n      const lineElement = isStatic && (\n        <div\n          style={{\n            overflow: \"hidden\",\n            opacity: prevFocus ? undefined : offOpacity,\n            height: lineHeight\n          }}\n          key={lineKey}\n        >\n          <div\n            style={{ display: \"inline-block\" }}\n            className={`cs-line cs-line-${lineKey}`}\n          >\n            {tokenElements}\n          </div>\n        </div>\n      );\n\n      let getLineStyle: StyleAnimation = emptyStyle;\n      if (!isStatic) {\n        if (!prevLine) {\n          const fadeInIndex = fadeInLines.indexOf(lineKey);\n          const fromOpacity = Array.isArray(nextFocus) ? 1 : 0;\n          const toOpacity = nextFocus ? 1 : offOpacity;\n          getLineStyle = enterLine(\n            fromOpacity,\n            toOpacity,\n            fadeInIndex,\n            fadeInLines.length,\n            lineHeight\n          );\n        } else if (!nextLine) {\n          const fadeOutIndex = fadeOutLines.indexOf(lineKey);\n          const fromOpacity = prevFocus ? 1 : offOpacity;\n          const toOpacity = Array.isArray(prevFocus) ? 1 : 0;\n          getLineStyle = exitLine(\n            fromOpacity,\n            toOpacity,\n            fadeOutIndex,\n            fadeOutLines.length,\n            lineHeight\n          );\n        } else if (!prevFocus && nextFocus && !Array.isArray(nextFocus)) {\n          const fadeInIndex = fadeInLines.indexOf(lineKey);\n          getLineStyle = fadeInFocus(\n            offOpacity,\n            1,\n            fadeInIndex,\n            fadeInLines.length\n          );\n        } else if (prevFocus && !nextFocus && !Array.isArray(prevFocus)) {\n          const fadeOutIndex = fadeOutLines.indexOf(lineKey);\n          getLineStyle = fadeOutFocus(\n            1,\n            offOpacity,\n            fadeOutIndex,\n            fadeOutLines.length\n          );\n        }\n      }\n\n      let getTokenStyle: (t: number, i: number) => CSSProperties = emptyStyle;\n      if (!areTokensStatic) {\n        const fromFocus = tokens[lineKey].map((_, tokeni) =>\n          Array.isArray(prevFocus) ? prevFocus.includes(tokeni) : prevFocus\n        );\n        const toFocus = tokens[lineKey].map((_, tokeni) =>\n          Array.isArray(nextFocus) ? nextFocus.includes(tokeni) : nextFocus\n        );\n        const fadeInIndex = fadeInLines.indexOf(lineKey);\n        const fadeOutIndex = fadeOutLines.indexOf(lineKey);\n        getTokenStyle = (t, i) => {\n          const fromOpacity = !prevLine ? 0 : fromFocus[i] ? 1 : offOpacity;\n          const toOpacity = !nextLine ? 0 : toFocus[i] ? 1 : offOpacity;\n          const animation =\n            fromOpacity < toOpacity\n              ? fadeInFocus(\n                  fromOpacity,\n                  toOpacity,\n                  fadeInIndex,\n                  fadeInLines.length\n                )\n              : fadeOutFocus(\n                  fromOpacity,\n                  toOpacity,\n                  fadeOutIndex,\n                  fadeOutLines.length\n                );\n          return animation(t);\n        };\n      }\n\n      return {\n        lineKey,\n        lineElement,\n        tokenElements,\n        getLineStyle,\n        getTokenStyle\n      };\n    });\n  }, [stepPair]);\n\n  return (\n    <React.Fragment>\n      {lines.map(\n        ({\n          lineElement,\n          lineKey,\n          tokenElements,\n          getLineStyle,\n          getTokenStyle\n        }) =>\n          lineElement || (\n            <div\n              style={{ overflow: \"hidden\", ...getLineStyle(t) }}\n              key={lineKey}\n            >\n              <div\n                style={{ display: \"inline-block\" }}\n                className={`cs-line cs-line-${lineKey}`}\n              >\n                {tokenElements ||\n                  tokens[lineKey].map((token, tokeni) => (\n                    <span\n                      className={\"token-\" + types[lineKey][tokeni]}\n                      style={getTokenStyle!(t, tokeni)}\n                      key={tokeni}\n                    >\n                      {token}\n                    </span>\n                  ))}\n              </div>\n            </div>\n          )\n      )}\n    </React.Fragment>\n  );\n}\n","export class Tuple<T> {\n  prev: Maybe<T>;\n  next: Maybe<T>;\n\n  constructor(prev: Maybe<T>, next: Maybe<T>) {\n    this.prev = prev;\n    this.next = next;\n  }\n\n  spread(): [Maybe<T>, Maybe<T>] {\n    const prev = this.prev;\n    const next = this.next;\n    return [prev, next];\n  }\n\n  select<S>(selector: (x: T) => S) {\n    const [prev, next] = this.spread();\n    const [newPrev, newNext] = [\n      prev === null ? null : prev === undefined ? undefined : selector(prev),\n      next === null ? null : next === undefined ? undefined : selector(next)\n    ];\n    return new Tuple(newPrev, newNext);\n  }\n\n  selectMany<S extends { key?: any }>(selector: (x: T) => S[]) {\n    const [prev, next] = this.spread();\n    const [newPrev, newNext] = [\n      prev === null ? null : prev === undefined ? undefined : selector(prev),\n      next === null ? null : next === undefined ? undefined : selector(next)\n    ];\n    return new ArrayTuple<S>(newPrev, newNext);\n  }\n\n  any() {\n    const [prev, next] = this.spread();\n    return prev == null ? next : prev;\n  }\n\n  get(_key: any) {\n    throw Error(\"Get only supported in ArrayTuple\");\n  }\n\n  map(_mapper: any) {\n    throw Error(\"Map only supported in ArrayTuple\");\n  }\n}\n\nexport class ArrayTuple<T extends { key?: any }> extends Tuple<T[]> {\n  _dict?: Map<any, Tuple<T>>;\n\n  _getChildrenMap() {\n    if (!this._dict) {\n      const [maybePrevs, maybeNexts] = this.spread();\n      const prevs: T[] = maybePrevs || [];\n      const nexts: T[] = maybeNexts || [];\n\n      const unsortedMap = new Map<any, { prev: Maybe<T>; next?: Maybe<T> }>(\n        prevs.map(prev => [prev.key, { prev }])\n      );\n      nexts.forEach(next => {\n        const { prev } = unsortedMap.get(next.key) || { prev: undefined };\n        unsortedMap.set(next.key, { prev, next });\n      });\n\n      const sortedKeys = Array.from(unsortedMap.keys());\n      sortedKeys.sort((a, b) => (a < b ? -1 : a > b ? 1 : 0));\n      this._dict = new Map<any, Tuple<T>>(\n        sortedKeys.map(key => {\n          const { prev = undefined, next = undefined } =\n            unsortedMap.get(key) || {};\n          return [key, new Tuple(prev, next)];\n        })\n      );\n    }\n    return this._dict;\n  }\n\n  get(key: any): Tuple<T> | undefined {\n    const childrenMap = this._getChildrenMap();\n    return childrenMap.get(key);\n  }\n\n  map<M>(mapper: (t: Tuple<T>, key?: any, self?: ArrayTuple<T>) => M) {\n    const childrenMap = this._getChildrenMap();\n    const result: M[] = [];\n    childrenMap.forEach((tuple, key) => result.push(mapper(tuple, key, this)));\n    return result;\n  }\n}\n","import React from \"react\";\nimport { Step, Dimensions } from \"code-surfer-types\";\nimport { Styled, useUnfocusedStyle } from \"@code-surfer/themes\";\nimport { LineList } from \"./lines\";\nimport {\n  fadeOutIn,\n  halfFadeIn,\n  halfFadeOut,\n  scrollToFocus,\n  scaleToFocus\n} from \"./animation\";\nimport { Tuple } from \"./tuple\";\n\ntype ContainerProps = {\n  progress: number;\n  dimensions?: Dimensions;\n  steps: Step[];\n  tokens: string[][];\n  types: string[][];\n};\n\nfunction CodeSurferContainer({\n  progress,\n  dimensions,\n  steps,\n  tokens,\n  types\n}: ContainerProps) {\n  const prev = steps[Math.floor(progress)];\n  const next = steps[Math.floor(progress) + 1];\n  const stepPair = React.useMemo(() => new Tuple(prev, next), [prev, next]);\n\n  const titlePair = React.useMemo(() => stepPair.select(step => step.title), [\n    stepPair\n  ]);\n  const subtitlePair = React.useMemo(\n    () => stepPair.select(step => step.subtitle),\n    [stepPair]\n  );\n\n  const t = progress % 1;\n\n  return (\n    <div\n      className=\"cs-container\"\n      style={{\n        width: \"100%\",\n        height: dimensions ? dimensions.containerHeight : \"100%\",\n        maxHeight: \"100%\",\n        position: \"relative\"\n      }}\n    >\n      <CodeSurferContent\n        dimensions={dimensions}\n        stepPair={stepPair}\n        t={t}\n        tokens={tokens}\n        types={types}\n      />\n      <Title textPair={titlePair} t={t} />\n      <Subtitle textPair={subtitlePair} t={t} />\n    </div>\n  );\n}\n\nfunction CodeSurferContent({\n  dimensions,\n  stepPair,\n  t,\n  tokens,\n  types\n}: {\n  dimensions?: Dimensions;\n  stepPair: Tuple<Step>;\n  t: number;\n  tokens: string[][];\n  types: string[][];\n}) {\n  const ref = React.useRef<HTMLPreElement | null>(null);\n\n  const scaleAnimation = React.useMemo(\n    () => scaleToFocus(stepPair, dimensions),\n    [stepPair, dimensions]\n  );\n\n  const scrollAnimation = React.useMemo(\n    () => scrollToFocus(stepPair, dimensions),\n    [stepPair, dimensions]\n  );\n\n  const scale = scaleAnimation(t);\n  const scrollTop = scrollAnimation(t);\n  const verticalOrigin = dimensions\n    ? dimensions.containerHeight / 2 + scrollTop\n    : 0;\n\n  React.useLayoutEffect(() => {\n    if (ref.current == null) return;\n    ref.current.scrollTop = scrollTop;\n  }, [scrollTop]);\n\n  const unfocusedStyle = useUnfocusedStyle();\n\n  return (\n    <Styled.Pre\n      className=\"cs-content\"\n      ref={ref}\n      style={{\n        margin: 0,\n        height: \"100%\",\n        overflow: \"hidden\"\n      }}\n    >\n      <Styled.Code\n        className=\"cs-scaled-content\"\n        style={{\n          display: \"block\",\n          //TODO isnt contentHeight always undefined?\n          height: dimensions ? dimensions.contentHeight : \"100%\",\n          width: dimensions && dimensions.contentWidth,\n          margin:\n            dimensions &&\n            `0 ${(dimensions.containerWidth - dimensions.contentWidth) / 2}px`,\n          transform: `scale(${scale})`,\n          transformOrigin: `center ${verticalOrigin}px`\n        }}\n      >\n        <div style={{ height: dimensions && dimensions.containerHeight / 2 }} />\n        <LineList\n          stepPair={stepPair}\n          t={t}\n          tokens={tokens}\n          types={types}\n          dimensions={dimensions}\n          unfocusedStyle={unfocusedStyle}\n        />\n        <div style={{ height: dimensions && dimensions.containerHeight / 2 }} />\n      </Styled.Code>\n    </Styled.Pre>\n  );\n}\n\ntype CaptionProps = { textPair: Tuple<string | undefined>; t: number };\n\nfunction Title({ textPair, t }: CaptionProps) {\n  if (!textPair.any()) {\n    return null;\n  }\n\n  const [prev, next] = textPair.spread();\n  const text = t < 0.5 ? prev : next;\n  const textStyle = prev !== next ? fadeOutIn()(t) : undefined;\n  const backgroundStyle =\n    prev && next ? undefined : !prev ? halfFadeIn()(t) : halfFadeOut()(t);\n\n  return (\n    <Styled.Title className=\"cs-title\" style={backgroundStyle}>\n      <span style={textStyle}>{text}</span>\n    </Styled.Title>\n  );\n}\n\nfunction Subtitle({ textPair, t }: CaptionProps) {\n  if (!textPair.any()) {\n    return null;\n  }\n\n  const [prev, next] = textPair.spread();\n  const text = t < 0.5 ? prev : next;\n  const textStyle = prev !== next ? fadeOutIn()(t) : undefined;\n  const backgroundStyle =\n    prev && next ? undefined : !prev ? halfFadeIn()(t) : halfFadeOut()(t);\n\n  return (\n    <Styled.Subtitle className=\"cs-subtitle\" style={backgroundStyle}>\n      <span style={textStyle}>{text}</span>\n    </Styled.Subtitle>\n  );\n}\n\nexport default CodeSurferContainer;\n","import React from \"react\";\nimport useDimensions from \"./dimensions\";\nimport Frame from \"./frame\";\nimport { Step } from \"code-surfer-types\";\n\ntype CodeSurferProps = {\n  steps: Step[];\n  progress: number; // float between [0, steps.lenght - 1]\n  tokens: string[][];\n  types: string[][];\n};\n\nexport function CodeSurfer({\n  progress,\n  steps,\n  tokens,\n  types\n}: CodeSurferProps) {\n  const fakeSteps = React.useMemo(() => getFakeSteps(steps, tokens), [steps]);\n\n  const ref = React.useRef<HTMLDivElement>(null);\n  const { dimensions, steps: stepsWithDimensions } = useDimensions(ref, steps);\n  if (!dimensions || !stepsWithDimensions) {\n    return (\n      <div\n        ref={ref}\n        style={{ overflow: \"auto\", height: \"100%\", width: \"100%\" }}\n      >\n        {fakeSteps.map((_step, i) => (\n          <div\n            key={i}\n            style={{\n              overflow: \"auto\",\n              height: \"100%\",\n              width: \"100%\"\n            }}\n          >\n            <Frame\n              steps={fakeSteps}\n              progress={i}\n              tokens={tokens}\n              types={types}\n            />\n          </div>\n        ))}\n      </div>\n    );\n  } else {\n    return (\n      <div\n        style={{ height: \"100%\", width: \"100%\", overflow: \"auto\" }}\n        ref={ref}\n      >\n        <Frame\n          steps={stepsWithDimensions}\n          progress={progress}\n          dimensions={dimensions}\n          tokens={tokens}\n          types={types}\n        />\n      </div>\n    );\n  }\n}\n\nfunction getFakeSteps(parsedSteps: Step[], tokens: string[][]) {\n  let shortLineKey = 0;\n  let length = 100;\n  for (let i = 1; i < tokens.length; i++) {\n    if (tokens[i].length < length) {\n      length = tokens[i].length;\n      shortLineKey = i;\n    }\n    if (length <= 1) {\n      break;\n    }\n  }\n\n  const fakeSteps = parsedSteps.map(step => {\n    const fakeStep: Step = {\n      ...step,\n      lines: step.lines.map(_ => shortLineKey),\n      longestLineIndex: 0\n    };\n    fakeStep.lines[0] = step.lines[step.longestLineIndex];\n    return fakeStep;\n  });\n  fakeSteps[0] = parsedSteps[0];\n  return fakeSteps;\n}\n","import React from \"react\";\n\n//  addEventListener<K extends keyof WindowEventMap>(type: K, listener: (this: Window, ev: WindowEventMap[K]) => any, options?: boolean | AddEventListenerOptions): void;\n// type addEventListener(type: string, listener: EventListenerOrEventListenerObject, options?: boolean | AddEventListenerOptions): void;\n\nexport default function useWindowResize(\n  handler: (this: Window, ev: WindowEventMap[\"resize\"]) => any,\n  deps: any[]\n) {\n  React.useEffect(() => {\n    window.addEventListener(\"resize\", handler);\n    return () => {\n      window.removeEventListener(\"resize\", handler);\n    };\n  }, deps);\n}\n","import React from \"react\";\nimport { InputStep, Step } from \"code-surfer-types\";\nimport { parseSteps } from \"@code-surfer/step-parser\";\nimport { StylesProvider, CodeSurferTheme, Styled } from \"@code-surfer/themes\";\nimport { UnknownError } from \"./errors\";\nimport { CodeSurfer } from \"./code-surfer\";\nimport \"./default-syntaxes\";\n\ntype ParsedSteps = {\n  steps: Step[];\n  tokens: string[][];\n  types: string[][];\n};\n\ntype CodeSurferProps = {\n  steps?: InputStep[];\n  parsedSteps?: ParsedSteps;\n  progress: number;\n  theme?: CodeSurferTheme;\n  nonblocking?: boolean;\n};\n\nfunction InnerCodeSurfer({\n  progress,\n  steps: inputSteps,\n  parsedSteps\n}: CodeSurferProps) {\n  const { steps, tokens, types } = React.useMemo(() => {\n    if (parsedSteps) return parsedSteps;\n    return parseSteps(inputSteps!);\n  }, [inputSteps, parsedSteps]);\n\n  if (!steps || steps.length === 0) {\n    throw new Error(\"No steps\");\n  }\n\n  return (\n    <CodeSurfer\n      progress={progress}\n      steps={steps}\n      tokens={tokens}\n      types={types}\n    />\n  );\n}\n\nfunction CodeSurferWrapper({ theme, nonblocking, ...props }: CodeSurferProps) {\n  const [wait, setWait] = React.useState(nonblocking);\n\n  React.useEffect(() => {\n    if (!wait) return;\n    setWait(false);\n  }, []);\n\n  if (wait)\n    return (\n      <StylesProvider theme={theme}>\n        <Styled.Placeholder />\n      </StylesProvider>\n    );\n\n  return (\n    <StylesProvider theme={theme}>\n      <InnerCodeSurfer {...props} />\n    </StylesProvider>\n  );\n}\n\nexport { CodeSurferWrapper as CodeSurfer, UnknownError };\n"],"names":["ErrorBox","body","React","style","background","color","border","padding","maxWidth","margin","fontFamily","fontSize","header","outerHeight","element","styles","window","getComputedStyle","parseFloat","offsetHeight","linear","t","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","distx","outHeight","EXIT","SCROLL","ENTER","emptyStyle","fadeInFocus","fromOpacity","toOpacity","staggerIndex","staggerLength","chain","undefined","stagger","opacity","tween","fadeOutFocus","fadeOutIn","offOpacity","fadeOut","fadeIn","halfFadeIn","halfFadeOut","shrinkHeight","lineHeight","height","easing","growHeight","from","to","ease","steps","start","Object","assign","prevTop","i","length","top","fn","animation","interval","end","st","Math","max","min","getZoom","step","dimensions","Error","containerWidth","contentWidth","contentHeight","focusCount","availableHeight","containerHeight","paddingBottom","paddingTop","LineList","stepPair","tokens","types","unfocusedStyle","lines","useMemo","linesPair","selectMany","map","lineKey","lineIndex","key","focus","fadeInLines","linePair","prev","spread","select","l","prevFocus","nextFocus","Array","isArray","filter","fadeOutLines","next","lineTuple","prevLine","nextLine","isStatic","areTokensStatic","tokenElements","token","tokeni","className","lineElement","overflow","display","getLineStyle","fadeOutIndex","indexOf","fadeInIndex","startOpacity","endOpacity","transform","exitLine","enterLine","getTokenStyle","fromFocus","_","includes","toFocus","Fragment","Tuple","this","selector","newPrev","newNext","ArrayTuple","any","get","_key","_mapper","_getChildrenMap","_dict","nexts","unsortedMap","Map","forEach","set","sortedKeys","keys","sort","a","b","mapper","childrenMap","result","tuple","push","_this","CodeSurferContainer","progress","floor","titlePair","title","subtitlePair","subtitle","width","maxHeight","position","CodeSurferContent","Title","textPair","Subtitle","ref","useRef","scaleAnimation","prevZoom","nextZoom","scaleToFocus","scrollAnimation","prevStep","nextStep","prevCenter","focusCenter","nextCenter","scroll","scrollToFocus","scale","scrollTop","verticalOrigin","useLayoutEffect","current","useUnfocusedStyle","Styled","Pre","Code","transformOrigin","text","textStyle","backgroundStyle","CodeSurfer","fakeSteps","parsedSteps","shortLineKey","fakeStep","longestLineIndex","getFakeSteps","handler","useState","setResult","useEffect","addEventListener","removeEventListener","containers","querySelectorAll","stepsDimensions","container","longestLineSpan","querySelector","containerParent","parentElement","lineCount","avaliableHeight","scrollHeight","clientHeight","clientWidth","getStepDimensions","d","useDimensions","stepsWithDimensions","Frame","_step","InnerCodeSurfer","inputSteps","parseSteps","theme","nonblocking","props","wait","setWait","StylesProvider","Placeholder","error","toString"],"mappings":"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"}